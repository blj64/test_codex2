generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Product {
  id               String   @id @default(uuid())
  name             String   @unique
  sku              String   @unique
  unitType         String
  unitPrice        Decimal  @default(0)
  quantity         Decimal  @default(0)
  lowStockThreshold Decimal?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  version          Int      @default(1)
  saleItems        SaleItem[]
}

model Sale {
  id        String     @id @default(uuid())
  date      DateTime
  items     SaleItem[]
  total     Decimal
  notes     String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  version   Int        @default(1)
}

model SaleItem {
  id                Int      @id @default(autoincrement())
  saleId            String
  productId         String
  quantity          Decimal
  unitPriceSnapshot Decimal
  sale              Sale     @relation(fields: [saleId], references: [id])
  product           Product  @relation(fields: [productId], references: [id])
}

@@index([name], name: "idx_product_name")
@@index([sku], name: "idx_product_sku")
@@index([date], name: "idx_sale_date")
@@index([productId], name: "idx_saleitem_product")
